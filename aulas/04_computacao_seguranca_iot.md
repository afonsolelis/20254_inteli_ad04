# [4] Computa√ß√£o - Seguran√ßa em IoT

**Unidade:** Semana 04
**Data:** 05/11/2025

## Tempo estimado
- Daily inicial (15 min)
- Aula narrativa expositiva (55 min) ‚Äî 7 atos com storytelling
- Atividade de grupo em sala (35 min) ‚Äî elabora√ß√£o de apresenta√ß√£o em markdown
- Apresenta√ß√µes dos grupos (35 min) ‚Äî 5 grupos √ó 7 min cada

## Objetivos de aprendizagem
- Acompanhar o cap√≠tulo "Quebra de Sigilo" da jornada da LogiTrack.
- Identificar amea√ßas t√≠picas em sistemas IoT usando threat modeling (STRIDE).
- Projetar contramedidas de seguran√ßa por camada da arquitetura IoT.
- Avaliar trade-offs entre seguran√ßa, custo e operacionalidade.

---

## Onde paramos na hist√≥ria
- **Aula 01:** LogiTrack descobriu a arquitetura IoT e mapeou camadas cr√≠ticas.
- **Aula 02:** Time financeiro provou a viabilidade do Projeto Atlas e garantiu or√ßamento.
- **Aula 03:** Marina e equipe definiram componentes, protocolos e arquitetura h√≠brida de conectividade.
- **Aula 04:** Fase piloto entra em opera√ß√£o ‚Äî e um incidente de seguran√ßa exp√µe vulnerabilidades cr√≠ticas.

---

## Quebra de Sigilo ‚Äî Storytelling da Aula

### Ato 1 ‚Äî O incidente: ter√ßa-feira, 08:47h

*A fase piloto do Projeto Atlas est√° rodando h√° duas semanas. Tr√™s caminh√µes equipados, telemetria fluindo para a nuvem. No NOC da LogiTrack, um alerta vermelho pisca: **"Risco de perda de carga ‚Äî temperatura cr√≠tica em SPC-023 e SPC-041"**.*

**Pedro Nascimento (TI):** "Dois ve√≠culos ao mesmo tempo? Isso n√£o √© normal."
**Operador do NOC:** "Eles ainda nem sa√≠ram do p√°tio. Compressores est√°veis."
**Marina Costa (Engenharia):** "Se n√£o √© f√≠sico, √© digital. Algu√©m mexeu nos nossos dados."

| Sintoma observado | Comportamento esperado | Hip√≥tese inicial |
| --- | --- | --- |
| Temperatura reportada: 28¬∞C (acima do limite) | Temperatura real: 4¬∞C (medida local) | Telemetria adulterada |
| Dois caminh√µes afetados simultaneamente | Eventos independentes | Ataque coordenado ou credenciais vazadas |
| Alertas disparados antes da partida | Sensores s√≥ reportam em movimento | Publica√ß√£o externa no broker MQTT |

**Decis√£o imediata:** Isolar os caminh√µes da rede, abrir investiga√ß√£o t√©cnica e convocar reuni√£o de emerg√™ncia na Base Atlas.

---

### Ato 2 ‚Äî Investiga√ß√£o: rastreando o intruso

Marina projeta o diagrama da arquitetura atual no quadro:

```
[Sensores] ‚Üí [Gateway 4G] ‚Üí [Broker MQTT gerenciado] ‚Üí [Pipeline de ingest√£o] ‚Üí [Banco anal√≠tico] ‚Üí [Metabase]
```

Pedro abre os **logs do broker MQTT**. Em 5 minutos, a equipe identifica:

| Evid√™ncia t√©cnica | O que revela | Gravidade |
| --- | --- | --- |
| Duas conex√µes de IPs desconhecidos | Acesso n√£o autorizado | üî¥ Cr√≠tica |
| Mesmo `clientId` usado por gateway leg√≠timo | Spoofing de identidade | üî¥ Cr√≠tica |
| Conex√£o aceita com TLS unilateral | Broker n√£o valida cliente | üü° Alta |
| Credenciais de teste em produ√ß√£o | Falta de rotacionamento | üü° Alta |
| T√≥pico `/lt/frota/SPC-023/telemetria` sem ACL | Qualquer cliente pode publicar | üî¥ Cr√≠tica |

**Carlos Mendes (Opera√ß√µes):** "Como isso passou nos nossos testes?"
**Juliana Prado (Arquitetura):** "Porque testamos funcionalidade, n√£o seguran√ßa. Agora vamos corrigir."

---

### Ato 3 ‚Äî Threat modeling: mapeando as amea√ßas com STRIDE

Juliana prop√µe um **threat modeling estruturado** usando o framework STRIDE sobre o fluxo cr√≠tico `sensor ‚Üí broker ‚Üí processamento`.

![Framework STRIDE aplicado ao Projeto Atlas](https://www.practical-devsecops.com/wp-content/uploads/2022/12/STRIDE-Threat-Model-identify-threats-980x540.webp)
*Figura 1 ‚Äì Mapa de amea√ßas STRIDE sobre a arquitetura atual do Projeto Atlas.*

| Categoria STRIDE | Amea√ßa identificada | Impacto no Projeto Atlas | Probabilidade |
| --- | --- | --- | --- |
| **S**poofing | Reutiliza√ß√£o de credenciais e clientId | Telemetria falsa aceita como leg√≠tima | üî¥ Alta |
| **T**ampering | Altera√ß√£o de payload em tr√¢nsito (TLS fraco) | Dados corrompidos antes de armazenar | üü° M√©dia |
| **R**epudiation | Aus√™ncia de trilhas criptograficamente verific√°veis | Imposs√≠vel provar origem da mensagem | üü° M√©dia |
| **I**nformation disclosure | T√≥picos leg√≠veis se houver downgrade de cifra | Exposi√ß√£o de rotas e cargas | üü° M√©dia |
| **D**enial of service | Floods de publish/subscribe | Broker sobrecarregado, telemetria perdida | üü¢ Baixa |
| **E**levation of privilege | Credenciais de teste com acesso amplo | Invasor publica em qualquer t√≥pico | üî¥ Alta |

**Juliana:** "Temos tr√™s amea√ßas cr√≠ticas. Vamos prioriz√°-las por camada."

---

### Ato 4 ‚Äî Contramedidas por camada: endurecendo a arquitetura

A equipe define um plano de mitiga√ß√£o estruturado por camada da arquitetura IoT.

#### 4.1 ‚Äî Camada de Dispositivo

| Vulnerabilidade | Contramedida | Implementa√ß√£o no Atlas | Trade-off |
| --- | --- | --- | --- |
| Credenciais compartilhadas | Identidade √∫nica por hardware (UUID + X.509) | Cada gateway recebe certificado √∫nico | Custo de PKI gerenciada |
| Firmware adulterado | Secure boot + assinatura de firmware | OTA s√≥ aceita imagens assinadas | Processo de build mais complexo |
| Replay de mensagens | Carimbo de tempo + nonce por mensagem | Backend valida timestamp e rejeita nonce repetido | Overhead de processamento |
| Perda de dados offline | Fila persistente local com backoff exponencial | Gateway armazena at√© reconectar | Custo de storage local |

**Marina:** "Nenhum gateway entra em campo sem certificado √∫nico. Zero exce√ß√µes."

---

#### 4.2 ‚Äî Camada de Comunica√ß√£o (Gateway ‚Üî Broker)

| Vulnerabilidade | Contramedida | Implementa√ß√£o no Atlas | Trade-off |
| --- | --- | --- | --- |
| TLS unilateral | **mTLS** obrigat√≥rio (mutual TLS) | Broker valida certificado do cliente | Complexidade de gest√£o de certificados |
| Senhas compartilhadas | Autentica√ß√£o via certificado X.509 | Elimina usu√°rio/senha | Depend√™ncia de CA (Certificate Authority) |
| Certificados eternos | Rotacionamento autom√°tico (janela de 90 dias) | Renova√ß√£o via ACME/Let's Encrypt | Janelas de manuten√ß√£o |
| Rede p√∫blica 4G | APN privada para frota | Reduz exposi√ß√£o da internet p√∫blica | Custo adicional por SIM |
| T√≥picos abertos | Namespace por dispositivo + ACL fina | `lt/{deviceId}/telemetria` (publish), `lt/{deviceId}/cmd` (subscribe) | Configura√ß√£o manual por dispositivo |
| QoS inadequado | Telemetria QoS 1, comandos QoS 2 | Balanceio entre confiabilidade e lat√™ncia | Overhead de rede |

**Tabela de QoS recomendado:**

| Tipo de mensagem | QoS | Justificativa |
| --- | --- | --- |
| Telemetria (temperatura, GPS) | 1 (at least once) | Perda ocasional toler√°vel, lat√™ncia importa |
| Comandos remotos (desligar motor) | 2 (exactly once) | N√£o pode ser executado duas vezes |
| Heartbeat | 0 (at most once) | Apenas para monitoramento, n√£o cr√≠tico |

---

#### 4.3 ‚Äî Camada de Broker MQTT

| Vulnerabilidade | Contramedida | Implementa√ß√£o no Atlas | Trade-off |
| --- | --- | --- | --- |
| Broker "aberto" | Inst√¢ncia dedicada com ACL fina | Regra: publish apenas em `lt/{CN do cert}/telemetria` | Custo de inst√¢ncia gerenciada |
| Flood de mensagens | Rate limiting por cliente + max inflight | 10 msg/s por cliente, 5 inflight | Poss√≠vel perda em picos leg√≠timos |
| Sess√µes eternas | Session expiry curto (5 min) | Cliente desconectado precisa reautenticar | Overhead de reconex√£o |
| AuthN fraca | mTLS como m√©todo √∫nico de autentica√ß√£o | CN do certificado mapeia para deviceId | ‚Äî |
| AuthZ gen√©rica | Pol√≠ticas por CN (Common Name do certificado) | `CN=SPC-023` s√≥ publica em `lt/SPC-023/*` | Gest√£o granular de pol√≠ticas |
| Logs n√£o audit√°veis | Logs assinados e exportados para SIEM | Integra√ß√£o com Splunk/ELK | Custo de SIEM |
| Bridge inseguro | Conector com assinatura HMAC de mensagens | Pipeline valida HMAC antes de processar | Overhead criptogr√°fico |

**Pedro:** "Vou provisionar a nova inst√¢ncia hoje. Migra√ß√£o no fim de semana."

---

#### 4.4 ‚Äî Camada de Backend (Processamento e Armazenamento)

| Vulnerabilidade | Contramedida | Implementa√ß√£o no Atlas | Trade-off |
| --- | --- | --- | --- |
| Payload n√£o verificado | Valida√ß√£o de HMAC na entrada do pipeline | Rejeita mensagens sem assinatura v√°lida | Lat√™ncia adicional |
| Schema frouxo | Esquemas r√≠gidos (JSON Schema) | Rejeita campos desconhecidos ou inv√°lidos | Menor flexibilidade |
| Outliers f√≠sicos aceitos | Valida√ß√£o de contexto (temp imposs√≠vel) | Rejeita temperatura fora de -20¬∞C a +50¬∞C | Pode descartar leituras v√°lidas em edge cases |
| Redes misturadas | Segmenta√ß√£o: rede de ingest√£o ‚â† analytics | VPC isolada para pipeline | Complexidade de rede |
| Secrets em env vars | Secret management centralizado (AWS Secrets Manager) | Rota√ß√£o autom√°tica de credenciais | Custo de servi√ßo gerenciado |
| RBAC inexistente | Princ√≠pio do menor privil√©gio + KMS | Lambda s√≥ l√™ do t√≥pico, n√£o escreve no banco diretamente | Mais permiss√µes a gerenciar |

**Juliana:** "Backend n√£o confia em ningu√©m. Valida tudo."

---

#### 4.5 ‚Äî Princ√≠pios de Arquitetura: Toler√¢ncia a Falhas e Atributos de Qualidade

Com as contramedidas por camada definidas, Marina prop√µe uma discuss√£o mais profunda sobre **princ√≠pios arquiteturais** que garantem resili√™ncia.

**Marina:** "N√£o basta resolver este incidente. Precisamos de uma arquitetura que **previna** problemas semelhantes. Vou apresentar dois frameworks que usaremos daqui pra frente."

##### 4.5.1 ‚Äî ISO/IEC 25010: Framework de Atributos de Qualidade

Juliana projeta um diagrama no quadro mostrando a **ISO/IEC 25010**, padr√£o internacional de qualidade de software:

| Grupo de Qualidade | Atributos Relevantes para IoT | Como aplicamos no Atlas |
| --- | --- | --- |
| **Reliability** | Availability, Fault Tolerance, Recoverability | Arquitetura em 3 n√≠veis, buffer local, retry autom√°tico |
| **Security** | Confidentiality, Integrity, Authenticity | mTLS, HMAC, certificados √∫nicos |
| **Performance Efficiency** | Time behavior, Resource utilization | QoS otimizado, rate limiting |
| **Maintainability** | Modularity, Testability | Componentes independentes, logs estruturados |
| **Usability** | Operability, Accessibility | M√∫ltiplas interfaces (app, switch, RF) |

**Juliana:** "A ISO 25010 define **31 atributos de qualidade**. Para IoT, os mais cr√≠ticos s√£o Reliability e Security. Mas h√° um desafio: **sensores s√£o FRACOS, cloud √© FORTE**. Como equilibrar?"

##### 4.5.2 ‚Äî O Desafio Arquitetural: Componentes Fracos + Componentes Fortes

| Componente | N√≠vel de Qualidade | Limita√ß√µes | Impacto no Sistema |
| --- | --- | --- | --- |
| **Sensores/Atuadores** | üî¥ POBRE (2/10) | Processamento limitado, falhas frequentes, sem criptografia nativa | Ponto √∫nico de falha |
| **Gateways** | üü° REGULAR (4/10) | Conectividade inst√°vel, energia limitada | Perda de dados offline |
| **Cloud Infrastructure** | üü¢ EXCELENTE (9/10) | Alta disponibilidade, seguran√ßa robusta, escal√°vel | Depend√™ncia de rede |
| **Sistema IoT Final** | üü¢ MUITO BOM (8/10) | **Apenas com arquitetura h√≠brida** | Meta: 99,9% disponibilidade |

**Pedro:** "Como chegamos de 2/10 nos sensores para 8/10 no sistema final?"
**Marina:** "Com **t√°ticas arquiteturais**. Deixa eu mostrar um exemplo pr√°tico."

##### 4.5.3 ‚Äî T√°ticas Arquiteturais para Confiabilidade de Sensores

Marina desenha o diagrama de **T√°ticas Arquiteturais** aplicado ao controle de temperatura dos caminh√µes:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  OBJETIVO: Medi√ß√µes confi√°veis de temperatura (evitar falsos    ‚îÇ
‚îÇ  positivos como no incidente de ter√ßa-feira)                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ   T√ÅTICAS APLICADAS      ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                     ‚îÇ                     ‚îÇ
        ‚ñº                     ‚ñº                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. INTEGRIDADE ‚îÇ  ‚îÇ 2. DETEC√á√ÉO DE   ‚îÇ  ‚îÇ 3. RECUPERA√á√ÉO   ‚îÇ
‚îÇ    DE LEITURA  ‚îÇ  ‚îÇ    INCONSIST√äNCIA‚îÇ  ‚îÇ    DE FALHAS     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                     ‚îÇ                     ‚îÇ
        ‚ñº                     ‚ñº                     ‚ñº
```

**Tabela de T√°ticas e Mecanismos:**

| T√°tica Arquitetural | Mecanismos T√©cnicos | Implementa√ß√£o no Atlas |
| --- | --- | --- |
| **1. Reading Integrity** (Integridade de Leitura) | ‚Ä¢ M√∫ltiplos sensores por caminh√£o<br>‚Ä¢ Leitura redundante (3x por minuto)<br>‚Ä¢ Algoritmo de consolida√ß√£o (mediana) | 3 sensores de temperatura por ba√∫ refrigerado; se 1 falhar, sistema usa os outros 2 |
| **2. Inconsistency Detection** (Detec√ß√£o de Inconsist√™ncias) | ‚Ä¢ Valida√ß√£o de padr√µes hist√≥ricos<br>‚Ä¢ Predi√ß√£o baseada em contexto<br>‚Ä¢ Detec√ß√£o de falso positivo/negativo | Se temperatura variar >10¬∞C em <1min, sistema rejeita e solicita nova leitura |
| **3. Consistency Recovery** (Recupera√ß√£o de Consist√™ncia) | ‚Ä¢ Registro de alertas e eventos<br>‚Ä¢ Snapshot do estado anterior<br>‚Ä¢ Rollback autom√°tico | Se leitura inv√°lida for detectada, sistema reverte para √∫ltimo estado consistente e marca sensor para manuten√ß√£o |

**Carlos:** "Isso explica por que o ataque funcionou: t√≠nhamos **1 sensor, 1 caminho, 0 valida√ß√£o**."
**Marina:** "Exatamente. Agora teremos **redund√¢ncia em hardware E software**."

##### 4.5.4 ‚Äî Arquitetura em 3 N√≠veis de Opera√ß√£o

Juliana apresenta a arquitetura final do Projeto Atlas, inspirada em padr√µes de **Fault-Tolerant Systems**:

| N√≠vel | Modo de Opera√ß√£o | Disponibilidade | Funcionalidades Ativas | Cen√°rio de Uso |
| --- | --- | --- | --- | --- |
| **N√≠vel 0: Offline** | Gateway desconectado | üü¢ 99,99% | Switch f√≠sico, leitura local de sensores | Falha total de rede; manuten√ß√£o preventiva |
| **N√≠vel 1: Local** | Gateway conectado √† rede local (WiFi/Ethernet) | üü¢ 99,5% | Monitoramento via app local, controle manual | Internet indispon√≠vel; opera√ß√£o em dep√≥sito |
| **N√≠vel 2: Internet** | Gateway conectado √† nuvem via 4G/LTE | üü¢ 99,9% | Telemetria em tempo real, alertas autom√°ticos, dashboards | Opera√ß√£o normal em rota |

**Diagrama de Conting√™ncia:**

```
Internet dispon√≠vel? ‚îÄ‚îÄ‚ñ∫ SIM ‚îÄ‚îÄ‚ñ∫ N√≠vel 2 (Cloud)
         ‚îÇ
         N√ÉO
         ‚îÇ
         ‚ñº
Rede local dispon√≠vel? ‚îÄ‚îÄ‚ñ∫ SIM ‚îÄ‚îÄ‚ñ∫ N√≠vel 1 (Local)
         ‚îÇ
         N√ÉO
         ‚îÇ
         ‚ñº
    N√≠vel 0 (Offline) ‚îÄ‚îÄ‚ñ∫ Armazena dados localmente at√© reconectar
```

**Pedro:** "Com essa arquitetura, mesmo se o 4G cair, o motorista consegue monitorar a temperatura pelo app?"
**Marina:** "Sim. E quando reconectar, o gateway envia todos os dados armazenados via HTTP batch."

##### 4.5.5 ‚Äî Trade-offs de Qualidade: Seguran√ßa vs. Usabilidade

Juliana alerta sobre um princ√≠pio fundamental de arquitetura:

> **"Toda decis√£o arquitetural envolve trade-offs. Aumentar um atributo pode degradar outro."**

**Exemplos de Trade-offs no Projeto Atlas:**

| Decis√£o Arquitetural | Atributo que Melhora | Atributo que Pode Degradar | Como Balanceamos |
| --- | --- | --- | --- |
| mTLS obrigat√≥rio | üîí **Security** +3 pontos | üé® **Usability** -1 ponto (complexidade de setup) | Provisionamento autom√°tico de certificados |
| Manuten√ß√£o preventiva a cada 6h | üîß **Maintainability** +2 | ‚ö° **Availability** -1 (sistema fica offline) | ‚ùå Rejeitado. Manuten√ß√£o a cada 24h √© o √≥timo |
| Buffer local de 7 dias | ‚ö° **Availability** +3 | üíæ **Storage** -1 (custo de mem√≥ria) | Aceit√°vel: custo de R$15/gateway |
| Valida√ß√£o tripla de sensores | üéØ **Reliability** +3 | ‚è±Ô∏è **Performance** -0,5s lat√™ncia | Aceit√°vel: alertas cr√≠ticos toleram 0,5s |

**Juliana:** "No incidente de ter√ßa, priorizamos **velocidade** sobre **valida√ß√£o**. Agora invertemos: preferimos 0,5s de lat√™ncia a mais do que um falso positivo que custa R$180 mil."

##### 4.5.6 ‚Äî Meta de Disponibilidade: 99,9% (Three Nines)

Com as t√°ticas implementadas, a equipe estabelece m√©tricas de qualidade:

| M√©trica de Qualidade | Meta do Projeto Atlas | Como Medimos |
| --- | --- | --- |
| **Disponibilidade** | 99,9% (8,76h downtime/ano) | Uptime monitoring com PingDom |
| **MTTR** (Mean Time to Recovery) | < 10 min | Tempo entre detec√ß√£o e conten√ß√£o de falhas |
| **MTTD** (Mean Time to Detect) | < 2 min | Tempo entre falha e alerta no NOC |
| **Taxa de Falsos Positivos** | < 0,1% | Alertas inv√°lidos / total de alertas |
| **Cobertura de Testes de Seguran√ßa** | > 90% | Cen√°rios STRIDE testados vs. total |

**Henrique Duarte (Diretoria):** "99,9% significa que podemos ter at√© 8 horas de falha por ano. Isso √© aceit√°vel?"
**Marina:** "Para a fase piloto, sim. Quando escalarmos para 120 caminh√µes, subiremos para 99,99% (four nines = 52min/ano)."

---

#### 4.6 ‚Äî Camada de Opera√ß√µes (Runbooks e Playbooks)

| Cen√°rio | A√ß√£o de conten√ß√£o | A√ß√£o de erradica√ß√£o | A√ß√£o de recupera√ß√£o |
| --- | --- | --- | --- |
| Telemetria falsa detectada | Revogar certificado do dispositivo suspeito | Rotacionar todas as credenciais de teste | Valida√ß√£o cruzada com sensores redundantes |
| Flood de mensagens | Bloquear clientId no broker | Revisar rate limits | Restaurar QoS normal |
| Replay de mensagens antigas | Limpar retained messages | For√ßar nonce √∫nico por mensagem | Recalcular dashboards afetados |
| Downgrade de cifra | For√ßar TLS 1.3 m√≠nimo | Auditar configura√ß√µes de broker | Testar reconex√£o de todos os gateways |

**Runbook de incidente ‚Äî Falsifica√ß√£o de telemetria:**

1. **Detec√ß√£o:** Alerta autom√°tico no NOC (temperatura fora do padr√£o f√≠sico esperado)
2. **Conten√ß√£o:** Revogar certificado do cliente suspeito (< 2 min)
3. **Investiga√ß√£o:** Analisar logs do broker para identificar IP e clientId
4. **Erradica√ß√£o:** Rotacionar credenciais de teste, for√ßar mTLS
5. **Recupera√ß√£o:** Validar dados limpos, recalcular m√©tricas afetadas
6. **P√≥s-incidente:** Documentar li√ß√µes aprendidas, atualizar playbook

**Carlos:** "Vou treinar o time do NOC com este runbook amanh√£."

---

### Ato 6 ‚Äî Prova de corre√ß√£o: testando as defesas

Com as contramedidas implementadas, a equipe executa **testes de intrus√£o controlados**:

| Teste de seguran√ßa | M√©todo | Resultado esperado | Resultado obtido |
| --- | --- | --- | --- |
| **Replay de credenciais antigas** | Tentar conectar com certificado revogado | Broker recusa na camada TLS | ‚úÖ Conex√£o negada (TLS handshake falhou) |
| **Replay de mensagem v√°lida** | Reenviar payload capturado com mesmo nonce | Backend rejeita por nonce duplicado | ‚úÖ Mensagem descartada (nonce j√° visto) |
| **Flood de publish** | Enviar 50 msg/s de um √∫nico cliente | Rate limiting ativa, cliente isolado | ‚úÖ Cliente bloqueado ap√≥s 10 msg/s |
| **Publica√ß√£o em t√≥pico de outro dispositivo** | Tentar publicar em `lt/SPC-041/telemetria` com certificado de SPC-023 | ACL bloqueia (CN n√£o corresponde ao t√≥pico) | ‚úÖ Publish rejeitado (ACL violation) |
| **Downgrade de TLS** | For√ßar TLS 1.1 | Broker rejeita conex√£o (TLS 1.3 m√≠nimo) | ‚úÖ Conex√£o negada (protocol version) |

**Marina:** "Todas as defesas operacionais. Dashboard voltou ao normal."

---

### Ato 7 ‚Äî Apresenta√ß√£o executiva: custo vs. risco evitado

A diretoria √© informada em linguagem executiva. Henrique Duarte questiona o investimento adicional.

**Pedro:** "Incremento mensal de infraestrutura segura: R$ 12 mil (mTLS gerenciado, PKI, SIEM)."
**Marina:** "Custo evitado de uma **√∫nica carga de f√°rmacos perdida**: R$ 180 mil. Payback em 45 dias."
**Juliana:** "M√©tricas de resili√™ncia ap√≥s endurecimento:"

| M√©trica | Antes do incidente | Depois das corre√ß√µes |
| --- | --- | --- |
| **Falso-positivo por telemetria adulterada** | 2 eventos/semana | 0 eventos (√∫ltimas 4 semanas) |
| **Mean Time to Detect (MTTD)** | 14 min | 2 min |
| **Mean Time to Contain (MTTC)** | N/A (sem runbook) | 9 min |
| **Certificados √∫nicos em campo** | 0% (credenciais compartilhadas) | 100% (3/3 gateways) |
| **mTLS ativo** | N√£o | Sim (TLS 1.3) |

**Henrique:** "A conta fecha. Aprovado. Mas quero isso documentado para auditoria."

**Juliana fecha a reuni√£o com um compromisso:**

> "Pacto de disciplina t√©cnica: nenhuma feature nova entra sem **revis√£o de amea√ßas** (STRIDE), e todo componente passa por **checklist de seguran√ßa** antes de produ√ß√£o."

---

## Atividade de grupo em sala

**Desafio:** Cada grupo recebe um **cen√°rio de ataque** diferente e deve elaborar uma apresenta√ß√£o em markdown destrinchando o cen√°rio e propondo um plano de mitiga√ß√£o completo baseado na arquitetura IoT que definiram na Aula 03.

### Cen√°rios de ataque (1 por grupo - 5 grupos):

1. **Ataque de Man-in-the-Middle:** Invasor intercepta comunica√ß√£o entre gateway e broker, tenta ler e alterar mensagens.
2. **Ataque de Denial of Service:** Invasor envia flood de 1000 mensagens/segundo no broker MQTT.
3. **Ataque de Firmware Malicioso:** Invasor tenta instalar firmware adulterado em gateway via OTA.
4. **Ataque de Credential Stuffing:** Invasor obt√©m lista de credenciais vazadas e tenta acessar m√∫ltiplos dispositivos.
5. **Ataque de Spoofing de Dispositivo:** Invasor clona identidade de gateway leg√≠timo e publica telemetria falsa.

### Entreg√°vel (por grupo):

**Apresenta√ß√£o em markdown** contendo:

1. **Descri√ß√£o do cen√°rio de ataque:** Como o ataque acontece passo a passo na arquitetura da LogiTrack.
2. **An√°lise STRIDE:** Tabela com 6 categorias identificando amea√ßas espec√≠ficas do cen√°rio.
3. **Contramedidas por camada:** Tabela com mitiga√ß√µes para dispositivo, comunica√ß√£o, broker, backend e opera√ß√µes.
4. **Runbook de incidente:** Etapas de detec√ß√£o, conten√ß√£o, erradica√ß√£o e recupera√ß√£o.
5. **Justificativa executiva:** Argumento de custo vs. risco evitado para convencer a diretoria.

### Formato da apresenta√ß√£o:

- **Arquivo markdown** (.md) com tabelas e estrutura clara
- **Sem slides** - apresenta√ß√£o direta do markdown
- **Tempo de apresenta√ß√£o:** 5-7 minutos por grupo
- **Discuss√£o em sala:** Ap√≥s cada apresenta√ß√£o, turma debate as solu√ß√µes propostas

### Pontos para discuss√£o:

- As contramedidas s√£o realistas para a LogiTrack?
- H√° trade-offs que n√£o foram considerados?
- O runbook √© execut√°vel pela equipe do NOC?
- Outras solu√ß√µes poss√≠veis que o grupo n√£o mencionou?

---

## Ganchos para a pr√≥xima aula ‚Äî Coleta de Dados com MQTT e HTTP

- A arquitetura est√° segura. Agora √© hora de escalar: como **coletar dados de forma robusta** em produ√ß√£o?
- MQTT √© ideal para telemetria, mas **quando usar HTTP**? E como **integrar ambos**?
- Como garantir que dados n√£o se percam durante quedas de rede? **Buffer local, QoS e persist√™ncia**.
- **Marina anuncia:** "Na pr√≥xima semana, ampliamos o piloto de 3 para 15 caminh√µes. Precisamos de um pipeline de coleta que aguente."

---

## Refer√™ncias T√©cnicas desta Aula

Esta aula foi baseada em pesquisas cient√≠ficas de arquitetura de sistemas IoT:

1. **Hayashi, V. T., Garcia, V., Andrade, R. M., & Arakaki, R. (2020).** "OKIoT Open Knowledge IoT Project: Smart Home Case Studies of Short-term Course and Software Residency Capstone Project". *IoTBDS 2020 - 5th International Conference on Internet of Things, Big Data and Security*.
   - **Conceitos aplicados:** Arquitetura em 3 n√≠veis de opera√ß√£o (offline, local, internet), fault-tolerant design, redund√¢ncias de comunica√ß√£o.

2. **Arakaki, R., Hayashi, V. T., & Ruggiero, W. V. (2020).** "Available and Fault Tolerant IoT System: Applying Quality Engineering Method". *ICECCE 2020 - 2nd International Conference on Electrical, Communication and Computer Engineering*.
   - **Conceitos aplicados:** ISO/IEC 25010 (atributos de qualidade), t√°ticas arquiteturais (Reading Integrity, Inconsistency Detection, Consistency Recovery), an√°lise de trade-offs, m√©tricas de disponibilidade (MTTR, MTTD).

3. **ISO/IEC 25010:2011.** "Systems and software engineering ‚Äî Systems and software Quality Requirements and Evaluation (SQuaRE) ‚Äî System and software quality models".
   - **Conceitos aplicados:** 8 grupos de atributos de qualidade (Reliability, Security, Performance, Maintainability, Usability, Compatibility, Portability, Functional Suitability).

---

**Preparado para a Aula 05:**
- Revisar conceitos de MQTT (pub/sub, QoS, retained messages)
- Pesquisar padr√µes de integra√ß√£o HTTP/REST em IoT
- Estudar estrat√©gias de buffer local e retry
- Entender diferen√ßas entre push (MQTT) e pull (HTTP polling)
- Revisar princ√≠pios de arquitetura tolerante a falhas (Aula 04)
